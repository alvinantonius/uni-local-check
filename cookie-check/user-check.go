package main

import (
	"encoding/json"
	"fmt"
	"log"

	"gopkg.in/olivere/elastic.v3"
)

var client *elastic.Client

func init() {
	connect([]string{"http://127.0.0.1:9200"})
}

func connect(hosts []string) {
	var err error
	client, err = elastic.NewClient(elastic.SetURL(hosts...))
	if err != nil {
		log.Panic(err)
	}
}

type seg struct {
	Name string `json:"fullname"`
}

type camp struct {
	Name string `json:"name"`
}

func main() {
	searchSegment()
}

func searchCampaign() {
	data := []int64{801952,
		933607,
		933632,
		934177,
		934429,
		905238,
		905344,
		905350,
		905461,
		905547,
		905553,
		920896,
		921003,
		921009,
		936377,
		941435,
		957669,
		972347,
		972350,
		1019255,
		1281981,
		1139254,
		1139302,
		1147096,
		1005942,
		1018679,
		1019022,
		1305060,
		1305087,
		1305408,
		562,
		13262,
		811149,
		811174,
		1301038,
		1301066,
		1301382,
		10764,
		766641,
		801143,
		968145,
		855642,
		855668,
		855789,
		948676,
		948701,
		949054,
		1111778,
		1111793,
		1111879,
		1119517,
		1249019,
		1249406,
		1249716,
		770711,
		822000,
		822025,
		1287351,
		1287380,
		1287658,
		772987,
		801563,
		801585,
		814001,
		2755,
		11892,
		800935,
		802784,
		961636,
		961661,
		961944,
		966066,
		822752,
		822777,
		822961,
		823168,
		1413044,
		1413053}

	for _, id := range data {

		query := elastic.NewMatchQuery("eyeota_id", id)
		res, err := client.Search().
			Index("uni").
			Query(query).
			Type("campaigns").
			Do()
		if err != nil {
			log.Println(err)
		}

		total := res.Hits.TotalHits
		if total == 0 {
			continue
		}

		for _, hit := range res.Hits.Hits {
			var s camp
			json.Unmarshal(*hit.Source, &s)
			fmt.Println(s.Name)
		}
	}
}

func searchSegment() {

	// data := []string{"1499361378", "2011750906", "-2147466863", "-2147466861", "-2147466857", "-2147466855", "-2147466854", "-2147466852", "-2147466846", "-2147466826", "-2147466825", "-2147466821", "-2147466818", "-2147466816", "-2147466811", "-2147466810", "-2147466807", "-2147466805", "-2147466804", "-2147466797", "-2147466795", "-2147466793", "-2147466792", "-2147466790", "-2147466787", "-2147466742", "-2147466737", "-2147466731", "-2147466728", "-2147466721", "-2147466718", "-2147466715", "-2147466712", "-2147466710", "-2147466708", "-2147466707", "-2147446642", "-2147444166", "-2147444077", "-2147430486", "-2147430397", "-2147427246", "-2147427245", "-2147427185", "-2147427183", "-2147427176", "-2147427175", "-2147426409", "-2147425130", "-1541783940", "-639793457", "-632388669", "-356205797"}
	data := []int64{-719133001,
		1499361378,
		2011750906,
		-2147466863,
		-2147466861,
		-2147466857,
		-2147466855,
		-2147466854,
		-2147466852,
		-2147466846,
		-2147466826,
		-2147466825,
		-2147466821,
		-2147466818,
		-2147466816,
		-2147466811,
		-2147466810,
		-2147466807,
		-2147466805,
		-2147466804,
		-2147466797,
		-2147466795,
		-2147466793,
		-2147466792,
		-2147466790,
		-2147466787,
		-2147466742,
		-2147466737,
		-2147466731,
		-2147466728,
		-2147466721,
		-2147466718,
		-2147466715,
		-2147466712,
		-2147466710,
		-2147466708,
		-2147466707,
		-2147446642,
		-2147444166,
		-2147444077,
		-2147430486,
		-2147430397,
		-2147427246,
		-2147427245,
		-2147427185,
		-2147427183,
		-2147427176,
		-2147427175,
		-2147426409,
		-2147425130,
		-2147425044,
		-2147425029,
		-1541783940,
		-639793457,
		-632388669,
		-356205797,
	}

	for _, id := range data {

		query := elastic.NewMatchQuery("fullkey", id)
		res, err := client.Search().
			Index("uni").
			Query(query).
			Type("segments").
			Do()
		if err != nil {
			log.Println(err)
		}

		total := res.Hits.TotalHits
		if total == 0 {
			continue
		}

		for _, hit := range res.Hits.Hits {
			var s seg
			json.Unmarshal(*hit.Source, &s)
			fmt.Println(s.Name)
		}
	}

}
